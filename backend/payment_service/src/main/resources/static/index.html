<!DOCTYPE html>
<html>
<head>
    <title>Razorpay Test</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<h2>Razorpay Payment Test</h2>

<form id="paymentForm">
    <input type="text" id="name" placeholder="Name" required><br><br>
    <input type="email" id="email" placeholder="Email" required><br><br>
    <input type="text" id="phone" placeholder="Phone" required><br><br>
    <input type="number" id="amount" placeholder="Amount (INR)" required><br><br>

    <button type="submit">Pay Now</button>
</form>

<script>
document.getElementById("paymentForm").addEventListener("submit", function(e) {
    e.preventDefault();
    createOrder();
});

function createOrder() {
    fetch("/payments/create-order", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            amount: document.getElementById("amount").value,
            currency: "INR",
            orderStatus: "CREATED"
        })
    })
    .then(res => res.json())
    .then(order => openRazorpay(order))
    .catch(err => alert("Order creation failed"));
}

function openRazorpay(order) {

    var options = {
        key: "rzp_test_RraOM8IXxqyTLZ", // ðŸ”´ Razorpay Key ID
        amount: order.amount * 100,
        currency: order.currency,
        name: "ShowTime",
        description: "Payment Test",
        order_id: order.razorpayOrderId,

        handler: function (response) {
            verifyPayment(response);
        },

        prefill: {
            name: order.name,
            email: order.email,
            contact: order.phone
        }
    };

    var rzp = new Razorpay(options);
    rzp.open();
}

function verifyPayment(response) {
    fetch("/payments/payment-callback", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            razorpay_order_id: response.razorpay_order_id,
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_signature: response.razorpay_signature
        })
    })
    .then(res => res.json())
    .then(data => {
        alert("Payment SUCCESS!");
        console.log(data);
    })
    .catch(err => alert("Payment verification failed"));
}
</script>

</body>
</html>
